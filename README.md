# A bit of background
Sometime around September 2018, a customer approached us (the company I was working for at the time) to help automate their operations as much as possible in order to improve the overall productivity of their pig ranch, which was in dire need of some TLC - specifically, major mechanical changes and upgrades. Minimizing human interaction with the system was the ultimate goal, as their employees were still using the old-fashioned 'pencil and paper' method to track of the forage that was produced at their local mill and its subsequent distribution in the pigs ranch. This outdated approach was obviously prone to errors (mostly cos of human factor), hence the dire need for the upgrades and a better monitoring of the entire process.

The customer handled the mechanical aspects (installing rails, silos for forage storage, scales to measure input and output, and so on) while we took care of the automation and logic, specifically tracking the loading and distribution processes. We used a Schneider Electric PLC (a TM221 series device, if I recall correctly) to store data on an SD card in two separate log files, which were written cyclically (meaning older data would eventually be overwritten). One file, _Incarcare.log_, recorded the loading process, while the other, _Descarcare.log_, tracked the unloading. The PLC featured an FTP server, which allowed users with the correct username and password (hard-coded for convenience) to download these files, which were in a raw CSV format (see _Extra_ folder for examples).

**TLDR**: This app was born for two reasons:
The data, meaning records of the forage being filled and emptied from six silos, was generated by the PLC and saved on its SD card. However, since the logs were written cyclically, older data would eventually be overwritten, leading to the loss of important information for the customer, thus it was crucial to save all the records after sanitization of the content.

For the sake of learning a new programming language, I developed a fully functional app (initially built on .NET Framework version 4) and gave it to them free of charge. The app allowed them to easily retrieve both past and future records from the PLC without much effort on their part. The last time I spoke with them, they were still using the app on a daily basis.

# About the app
In the initial release, I used Visual Studio 2019 Community Edition to create an application that automated the process of retrieving raw logs from the PLC via its FTP server on a cron-based schedule. The logs were then processed, and the data was saved into an SQLite database, allowing the customer to view the information at any time, export it to an Excel spreadsheet, and more. The UI was built using the MetroModernUI library, with additional components from Krypton.Components.Suite. For Excel processing, I used the NPOI library, for scheduling tasks, this [cron library](https://github.com/HenriqueCaires/cron), and for FTP access, a client I found online (though I can’t recall the exact source). I don’t claim full credit for all the components used in this project as not everything was developed by me.

## To do:
- [ ] switch to using the singleton database (created, partially used)
- [ ] switch to FluentFTP to handle the downloads (not implemented cos need to do some testing first)
- [ ] update overall used logic and code
- [ ] ditch NPOI in favor of MiniExcel
- [ ] miscellaneous bug fixes and improvements
- [ ] fix visual artefacts that appeared after the change from .NET v4 to v6
- [ ] maybe switch to WPF and drop WinForms, MetroModernUI and so on

## Done so far:
- [x] drop the SingleInstanceMutex.cs altogether in favor of something a lot easier ([link](https://stackoverflow.com/a/819808))
- [x] switched to records instead of DataTable and major code changes in the logs parsing and saving them to the database
- [x] some stuff I don't remember right now xD
- [x] exposed various previously hard-coded settings into a JSON file
- [x] rebuilt database integrity check and exposed the schemas used in above file
- [x] simplified the logic behind parsing the Transport records
- [x] _trying_ to be more OOP friendly
